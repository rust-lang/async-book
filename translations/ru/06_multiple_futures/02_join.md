# `join!`

Макрос `futures::join` позволяет дождаться завершения нескольких разных
`futures` при одновременном их выполнении.

# `join!`

При выполнении нескольких асинхронных операций возникает соблазн просто
сделать несколько `.await` последовательно:

```rust
{{#include ../../../examples/06_02_join/src/lib.rs:naiive}}
```

Однако это будет медленнее, чем необходимо, так как он не начнёт пытаться выполнять
`get_music` до завершения `get_book`. В некоторых других языках,
`futures` выполняются до завершения, поэтому две операции могут быть запущены
одновременно сначала вызовом для каждой `async fn`, чтобы их запустить, а потом ожиданием обеих:

```rust
{{#include ../../../examples/06_02_join/src/lib.rs:other_langs}}
```

Однако `futures` на Rust не будут работать, пока для них не будет вызван `.await`.
Это означает, что оба приведённых выше фрагмента кода запустят
`book_future` и `music_future` последовательно, вместо того, чтобы запустить их
одновременно. Чтобы правильно запустить две `futures` одновременно, используйте
`futures::join!`:

```rust
{{#include ../../../examples/06_02_join/src/lib.rs:join}}
```

Значение, возвращаемое `join!` - это кортеж, содержащий выходные данные каждой из переданных `Future`.

## `try_join!`

Для `futures`, которые возвращают `Result`, рассмотрите возможность использования `try_join!` а не
`join!`. Так как `join!` завершается только после завершения всех `subfutures`,
он будет продолжать обрабатывать другие `futures` даже после одного из своих `subfutures` или вернёт ошибку `Err`.

В отличие от`join!`, `try_join!` завершится немедленно, если одна из `subfutures`
вернёт ошибку.

```rust
{{#include ../../../examples/06_02_join/src/lib.rs:try_join}}
```

Обратите внимание, что все `futures`, переданные в `try_join!`, должны иметь один и тот же тип ошибки.
Рассмотрите возможность использования функций `.map_err(|e| ...)` и `.err_into()` из
`futures::future::TryFutureExt` для консолидации типов ошибок:

```rust
{{#include ../../../examples/06_02_join/src/lib.rs:try_join_map_err}}
```
